MPASM  5.37                     STOPWATCH.ASM   11-12-2013  17:17:14         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001            title    "Dice program"
Warning[215]: Processor superseded by command line.  Verify processor symbol.
                      00002            list     p=16f84
                      00003            include  "p16f84.inc"
                      00001         LIST
                      00002 ; P16F84.INC  Standard Header File, Version 2.00    Microchip Technology, Inc.
Message[301]: MESSAGE: (Processor-header file mismatch.  Verify selected processor.)
                      00136         LIST
                      00004 ;          __FUSES  _CP_OFF&_XT_OSC&_WDT_OFF
                      00005 
                      00006 ;*******************************************************************
                      00007 ;                           dice.ASM
                      00008 ;                    Implement a simple electronic dice
                      00009 ;
                      00010 ; Description
                      00011 ;    Program for a PIC 16c84 unit to produce a seven segment dice 
                      00012 ;    display.  A 1->6 binary code is output on RB[0..3] and fed
                      00013 ;    to a BCD display.  A push switch is connected to RB1 and used
                      00014 ;    as a request for a new number.
                      00015 ;
                      00016 ; Method
                      00017 ;    The main program does a very fast 1->6 rotation count.  During
                      00018 ;    each increment the input switch is tested; while it is pressed
                      00019 ;    the display will be updated with a new value and the count disabled.
                      00020 ;
                      00021 ; Design notes
                      00022 ;    The design has been done using the pseudo-code method.
                      00023 ;       a. The logic of the application is described by a 'C'-like language.
                      00024 ;       b. The pseudo-code has then be converted to PIC assembly language.
                      00025 ;       c. The pseudo-code has been included as comments.
                      00026 ;
                      00027 ;    The debounce code includes a 40 millisecond delay.
                      00028 ;
                      00029 ; Version
                      00030 ;    J Herd    V1.0   March 1997
                      00031 ;*******************************************************************   
                      00032 ;
                      00033 ; I/O pin definitions
                      00034 ;
  00000000            00035 RA0        equ     d'0'      ; Port A line 0 pin
  00000004            00036 RB4             equ             d'4'
                      00037 ;
                      00038 ;*******************************************************************   
                      00039 ;
                      00040 ; Variable declarations.
                      00041 ;
  0000000C            00042 count        equ   h'0C'        ; dice count
  0000000D            00043 presses      equ   h'0D'        ; used for switch debounce
  0000000E            00044 delcnt       equ   h'0E'        ; parameter register for del1mS routine
  0000000F            00045 temp         equ   h'0F'        ; temporary register
                      00046 ;
                      00047 ;
                      00048 ;*******************************************************************
MPASM  5.37                     STOPWATCH.ASM   11-12-2013  17:17:14         PAGE  2
Dice program

LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00049 ;
                      00050 ; Initial system vectors.
                      00051 ;   
                      00052         org     h'00'           ; initialise system restart vector
0000   2???           00053         goto    start           ; 
                      00054 ;
                      00055 ;******************************************************************* 
                      00056 ;
                      00057 ; System subroutines.
                      00058 ;  
                      00059         org     h'05'           ; start of program space
                      00060 ;
                      00061 ;* init : initialise I/O ports and variables
                      00062 ;  ====
                      00063 ;
0005                  00064 init    
0005   1683           00065     bsf     STATUS, RP0        ; enable page 1 register set
0006   301F           00066         movlw   b'11111'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0007   0085           00067         movwf   TRISA              ; RA0   input
0008   30E0           00068         movlw   b'11100000'                 
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0009   0086           00069         movwf   TRISB              ; RB0-RB7 output
000A   1283           00070         bcf     STATUS, RP0        ; back to page 0 register set
                      00071 ;
                      00072 ; clear display
                      00073 ;
000B   300F           00074     movlw   h'0F'              ; h'0F' to this BCD display will clear
000C   0086           00075     movwf   PORTB
                      00076 ;
                      00077 ; Set dice counter to ZERO
                      00078 ;
000D   018C           00079         clrf    count              ; set dice count to ZERO
000E   0008           00080     return
                      00081 ;
                      00082 ;******************************************************************* 
                      00083 ;
                      00084 ;* del1ms : Provide a 1 millisecond delay.
                      00085 ;  ======
                      00086 ;
                      00087 ; Memory used
                      00088 ;    delcnt
                      00089 ; Calls
                      00090 ;    none.
                      00091 ;                        ; call = 2uS    (   2)
000F                  00092 del1ms  
000F   30C7           00093         movlw   d'199'       ;      + 1      (   3)
0010   008E           00094         movwf   delcnt       ;      + 1      (   4)
0011                  00095 del1    
0011   0000           00096         nop                  ;      + 199    ( 203)
0012   0000           00097         nop                  ;      + 199    ( 402)
0013   0B8E           00098         decfsz  delcnt,f     ;      + 200    ( 602)
0014   2???           00099         goto    del1         ;      + 396    ( 998)
MPASM  5.37                     STOPWATCH.ASM   11-12-2013  17:17:14         PAGE  3
Dice program

LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0015   0008           00100         return               ;      + 2      (1000)
                      00101 ;
                      00102 ;******************************************************************* 
                      00103 ;
                      00104 ; MAIN program
                      00105 ; ============
                      00106 ;
0016   2???           00107 start   call    init
                      00108 ;
                      00109 ;   for(;;) {
                      00110 ;       presses = 0;
                      00111 ;
0017                  00112 gameloop
0017   018D           00113         clrf      presses
                      00114 ;
                      00115 ;     presses = read(RA0);             /* read switch               */
                      00116 ;     delay(40);                       /* delay 40mS                */
                      00117 ;     presses = presses + read(RA0);   /* read switch a second time */
                      00118 ;
0018   1805           00119     btfsc     PORTA,RA0
0019   0A8D           00120     incf      presses,F
                      00121 ;
001A   3028           00122     movlw     d'40'
001B   008F           00123         movwf     temp
001C                  00124 loop1   
001C   2???           00125     call      del1ms 
001D   0B8F           00126     decfsz    temp,F
001E   2???           00127     goto      loop1 
                      00128 ;
001F   1805           00129     btfsc     PORTA,RA0         ; read switch a second time for debounce.
0020   0A8D           00130     incf      presses,F
                      00131 ;
                      00132 ;     if (presses == 0)          /* if 'presses==0' then no bounce detected */
                      00133 ;         display(count);
                      00134 ;
0021   088D           00135     movf      presses,F       ; test for zero
0022   1D03           00136     btfss     STATUS, Z
0023   2???           00137     goto      else1
0024   080C           00138     movf      count,W
                      00139    ; movwf     PORTB, RB4
0025   2???           00140     goto      exit1
                      00141 ;
                      00142 ;     else
                      00143 ;         count = count + 1;
                      00144 ;         if (count == 7)
                      00145 ;             count = 1;
                      00146 ;
0026                  00147 else1   
0026   0A8C           00148     incf      count,F
0027   080C           00149     movf      count,W
                      00150 ; display f
                      00151 ;       movwf   PORT
0028   3C07           00152     sublw     d'07'
MPASM  5.37                     STOPWATCH.ASM   11-12-2013  17:17:14         PAGE  4
Dice program

LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0029   1D03           00153     btfss     STATUS,Z          ;       test 0
002A   2???           00154     goto      exit2
                      00155 ;
002B   3001           00156     movlw     d'01'
002C   008C           00157     movwf     count
002D                  00158 exit2
002D                  00159 exit1
                      00160 ;
002D   2???           00161     goto      gameloop
                      00162 ;
                      00163     end
MPASM  5.37                     STOPWATCH.ASM   11-12-2013  17:17:14         PAGE  5
Dice program

SYMBOL TABLE
  LABEL                             VALUE 

C                                 00000000
DC                                00000001
EEADR                             00000009
EECON1                            00000088
EECON2                            00000089
EEDATA                            00000008
EEIE                              00000006
EEIF                              00000004
F                                 00000001
FSR                               00000004
GIE                               00000007
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
NOT_PD                            00000003
NOT_RBPU                          00000007
NOT_TO                            00000004
OPTION_REG                        00000081
PCL                               00000002
PCLATH                            0000000A
PORTA                             00000005
PORTB                             00000006
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
RA0                               00000000
RB4                               00000004
RBIE                              00000003
RBIF                              00000000
RD                                00000000
RP0                               00000005
RP1                               00000006
STATUS                            00000003
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
TMR0                              00000001
TRISA                             00000085
TRISB                             00000086
W                                 00000000
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_CP_OFF                           00003FFF
_CP_ON                            0000000F
_HS_OSC                           00003FFE
_LP_OSC                           00003FFC
MPASM  5.37                     STOPWATCH.ASM   11-12-2013  17:17:14         PAGE  6
Dice program

SYMBOL TABLE
  LABEL                             VALUE 

_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FFD
__16F877A                         00000001
__DEBUG                           1
count                             0000000C
del1                              00000011
del1ms                            0000000F
delcnt                            0000000E
else1                             00000026
exit1                             0000002D
exit2                             0000002D
gameloop                          00000017
init                              00000005
loop1                             0000001C
presses                           0000000D
start                             00000016
temp                              0000000F

Errors   :     0
Warnings :     1 reported,     0 suppressed
Messages :     3 reported,     0 suppressed

